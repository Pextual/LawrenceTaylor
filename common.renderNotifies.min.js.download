define(["ui.layer"],function(){return yTos.utils.namespace("yTos.helpers.Common.RenderNotifies"),yTos.helpers.Common.RenderNotifies=yTos.helpers.base.extend({initialize:function(){this.notifiesPolling=[],this.activeNotifies=[],this.sendNotifyOnLoaded=!1,this.update()},events:{},globalMessages:{"yTos::Cart::ItemsAdded":"update","yTos::Cart::ItemAdded":"update","yTos::Item::ItemAdded":"update","yTos::Item::ItemAddedToShoppingBag":"update","yTos::Cart::ItemDeleted":"update","yTos::Cart::ItemsDeleted":"update","yTos::Cart::ItemRemoved":"update","yTos::Account::ItemDeleted":"update","yTos::Account::ItemsAddedToWishList":"update","yTos::Account::AllItemsDeleteFromWishListDone":"update","yTos::Account::WishListEmptyDone":"update","yTos::Common::ActiveNotifiesList":"show","yTos::Common::ActiveNotify":"show","yTos::WishList::ItemsAdded":"update","yTos::Item::ItemAddedToWishlist":"update","yTos::Product::ProductAddedToWishlist":"update","yTos::WishList::AllItemsDeleteDone":"update","yTos::WishList::EmptyDone":"update"},localMessages:{},update:function(a,b,c){this.getHTML("/yTos/Plugins/CommonPlugin/RenderNotifies",{success:function(a){this.parseNotifies(b),this.notify("yTos::Common::GetRenderNotifiesDone",{content:a}),this.sendNotifyOnLoaded=!0}.bind(this),error:function(a){this.notify("yTos::Common::GetRenderNotifiesError",{content:a})}.bind(this),stripMe:!0,autoUpdate:!0})},renderActiveNotify:function(a){var b=[];b[a]=this.activeNotifies[a],this.notify("yTos::Common::ActiveNotify",{list:b})},setDelayNotify:function(a){function b(a,b){return new Date(a.getTime()+6e4*b)}if(a){var c=new Date(a.lastOperationInCart),d=new Date,e=b(c,a.delayMinutes)-d;if(e>0){var f=setTimeout(function(){this.renderActiveNotify(a.notifyType)}.bind(this),e);this.notifiesPolling[a.notifyType]=f}}},parseNotifies:function(a){var b=this.$el.children("div");this.activeNotifies=[],$.each(b,function(a,b){var c=$(b).data("ytosNotifyOptions");c&&c.isActive&&(this.activeNotifies[c.notifyType]={priority:c.priority,delayMinutes:c.delayMinutes,isEnabledDelayMinutes:c.isEnabledDelayMinutes,notifyType:c.notifyType,html:$(b).html()},c.isEnabledDelayMinutes&&c.delayMinutes>0&&this.setDelayNotify(c))}.bind(this));var c=$Y.where({isEnabledDelayMinutes:!1},this.activeNotifies);c.length>0&&this.sendNotifyOnLoaded!==!1&&("account.addItemToWishList"!==a||"wishlist.addItem"!==a)&&this.notify("yTos::Common::ActiveNotifiesList",{list:c,eventName:a})},show:function(a){for(var b="",c=a.list,d=0;d<c.length;d++)"undefined"!=typeof c[d]&&(b+=c[d].html);b='<div class="callToAction">'+b+"</div>",this.notify("yTos::OpenLayer",{content:b})}}),yTos.helpers.Common.RenderNotifies});